<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GAMITAS - Aplikasi Keselamatan Terpadu</title>

    <link rel="manifest" href="" />
    <meta name="theme-color" content="#ffffff" />
    <link
      rel="apple-touch-icon"
      href="https://cdn-icons-png.flaticon.com/512/3468/3468379.png"
    />

    <link
      href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css"
      rel="stylesheet"
    />

    <style>
      /* === GLOBAL RESET & BASE === */
      :root {
        --primary-color: #d32f2f;
        --primary-color-dark: #b71c1c;
        --secondary-color: #ff7043;
        --background-color: #f4f6f8;
        --text-color: #212121;
        --text-color-light: #757575;
        --card-bg: #ffffff;
        --header-bg: #ffffff;
        --border-color: #eeeeee;
        --tab-active-bg: #d32f2f;
      }
      * {
        box-sizing: border-box;
      }
      html {
        height: 100%;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #e9e9ef;
        color: var(--text-color);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
      }

      /* === MOBILE FRAME WRAPPER === */
      .mobile-wrapper {
        width: 100%;
        height: 100%;
        max-width: 450px;
        max-height: 950px;
        background-color: var(--background-color);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        border-radius: 20px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        position: relative;
      }

      /* === MAIN APP STRUCTURE === */
      #app-container,
      #login-screen,
      #register-screen {
        display: flex;
        flex-direction: column;
        height: 100%;
        width: 100%;
      }

      .scrollable-content {
        flex-grow: 1;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }

      /* === ANIMATION KEYFRAMES === */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      /* === LOGIN & REGISTER SCREEN STYLES === */
      #login-screen,
      #register-screen {
        background-color: var(--header-bg);
        padding: 24px;
        text-align: center;
        justify-content: center;
        align-items: center;
        overflow-y: auto;
      }
      .form-container {
        width: 100%;
        max-width: 400px;
        margin: auto;
      }
      .form-container .logo {
        font-weight: bold;
        font-size: 48px;
        color: var(--primary-color);
        margin-bottom: 16px;
        animation: fadeInUp 0.5s ease-out;
      }
      .form-container h2 {
        font-size: 24px;
        font-weight: 600;
        color: var(--text-color);
        margin-bottom: 8px;
        animation: fadeInUp 0.5s ease-out 0.1s;
        animation-fill-mode: both;
      }
      .form-container p {
        font-size: 16px;
        color: var(--text-color-light);
        margin-bottom: 40px;
        animation: fadeInUp 0.5s ease-out 0.2s;
        animation-fill-mode: both;
      }
      .login-choices {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      .login-choice-btn {
        display: flex;
        align-items: center;
        padding: 16px;
        background-color: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        text-align: left;
        animation: fadeInUp 0.5s ease-out;
        animation-fill-mode: both;
      }
      .login-choice-btn:nth-child(1) {
        animation-delay: 0.3s;
      }
      .login-choice-btn:nth-child(2) {
        animation-delay: 0.4s;
      }

      .login-choice-btn:hover {
        transform: translateY(-4px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border-color: var(--primary-color);
      }
      .login-choice-btn img {
        width: 40px;
        height: 40px;
        margin-right: 16px;
      }
      .login-choice-btn .btn-text h4 {
        margin: 0 0 4px 0;
        font-size: 16px;
        font-weight: 600;
      }
      .login-choice-btn .btn-text p {
        margin: 0;
        font-size: 14px;
        color: var(--text-color-light);
      }
      .register-link {
        margin-top: 24px;
        font-size: 14px;
        color: var(--text-color-light);
        animation: fadeInUp 0.5s ease-out 0.5s;
        animation-fill-mode: both;
      }
      .register-link a {
        color: var(--primary-color);
        font-weight: 600;
        text-decoration: none;
      }

      /* === REGISTER FORM STYLES === */
      .register-form {
        display: flex;
        flex-direction: column;
        gap: 16px;
        text-align: left;
      }
      .register-form .form-group {
        display: flex;
        flex-direction: column;
      }
      .register-form label {
        margin-bottom: 6px;
        font-weight: 500;
        font-size: 14px;
      }
      .register-form input {
        padding: 12px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        font-size: 16px;
      }
      .register-form button {
        padding: 14px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        margin-top: 16px;
      }

      /* === UTILITIES & PAGE TRANSITIONS === */
      .page {
        display: none;
      }
      .page.active {
        display: block;
        animation: fadeIn 0.4s ease-in-out;
      }

      /* === APP HEADER (REVAMPED) === */
      .app-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        background-color: var(--header-bg);
        flex-shrink: 0;
        position: sticky;
        top: 0;
        z-index: 100;
        transition: top 0.3s ease-in-out;
        border-bottom: 1px solid var(--border-color);
      }
      .app-header.hidden {
        top: -100px;
      }
      .app-header .logo {
        font-weight: bold;
        font-size: 24px;
        color: var(--primary-color);
      }
      .profile-dropdown {
        position: relative;
      }
      .profile-btn {
        background-color: transparent;
        border: none;
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
      }
      .profile-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background-color: var(--primary-color);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 16px;
      }
      .profile-dropdown-content {
        display: none;
        position: absolute;
        right: 0;
        top: 45px;
        background-color: white;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
        z-index: 1;
        border-radius: 8px;
        overflow: hidden;
      }
      .profile-dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 14px;
      }
      .profile-dropdown-content a:hover {
        background-color: #f1f1f1;
      }
      .profile-dropdown-content a svg {
        width: 16px;
        height: 16px;
        stroke: #555;
      }
      .profile-dropdown:hover .profile-dropdown-content {
        display: block;
      }

      /* === USER PROFILE SECTION === */
      .user-profile {
        padding: 24px 16px;
        background-color: var(--header-bg);
        border-bottom: 1px solid var(--border-color);
        flex-shrink: 0;
      }
      .user-profile .greeting p {
        margin: 0 0 4px 0;
        font-size: 14px;
        color: var(--text-color-light);
      }
      .user-profile .greeting h2 {
        margin: 0;
        font-size: clamp(22px, 5vw, 24px);
        font-weight: 600;
      }

      /* === TAB NAVIGATION === */
      .main-tabs {
        display: flex;
        gap: 10px;
        padding: 0 16px 20px 16px;
        background-color: var(--header-bg);
        overflow-x: auto;
        flex-shrink: 0;
      }
      .main-tabs .tab {
        padding: 8px 20px;
        border-radius: 20px;
        background-color: #e0e0e0;
        color: var(--text-color-light);
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        white-space: nowrap;
      }
      .main-tabs .tab.active {
        background-color: var(--tab-active-bg);
        color: white;
      }

      /* === MAIN CONTENT & CARDS === */
      main {
        padding: 16px;
      }

      /* === CAROUSEL BANNER === */
      .carousel-container {
        position: relative;
        overflow: hidden;
        border-radius: 20px;
        margin-bottom: 24px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        animation: fadeInUp 0.5s ease-out;
      }
      .carousel-track {
        display: flex;
        transition: transform 0.5s ease-in-out;
      }
      .carousel-slide {
        min-width: 100%;
        background: linear-gradient(
          105deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        border-radius: 20px;
        padding: 24px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        height: 180px;
      }
      .carousel-slide .card-title {
        font-size: 14px;
        font-weight: 600;
        opacity: 0.8;
        margin: 0 0 8px 0;
        text-transform: uppercase;
      }
      .carousel-slide .card-content {
        font-size: 20px;
        font-weight: bold;
        line-height: 1.4;
      }
      .carousel-dots {
        position: absolute;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 8px;
      }
      .carousel-dots .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.5);
        transition: background-color 0.3s;
        cursor: pointer;
      }
      .carousel-dots .dot.active {
        background-color: white;
      }

      /* === SECTION TITLE === */
      .section-title {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        animation: fadeInUp 0.5s ease-out 0.1s;
        animation-fill-mode: both;
      }
      .section-title h2 {
        margin: 0;
        font-size: 18px;
      }
      .section-title a {
        font-size: 14px;
        color: var(--primary-color);
        text-decoration: none;
      }

      /* === FEATURE GRID === */
      .feature-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 16px;
      }
      .feature-card {
        background-color: var(--card-bg);
        border-radius: 16px;
        padding: 12px;
        text-align: center;
        text-decoration: none;
        color: var(--text-color);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        animation: fadeInUp 0.5s ease-out;
        animation-fill-mode: both;
      }
      .feature-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
      }
      .feature-card .icon-wrapper {
        background-color: #feeceb;
        width: 56px;
        height: 56px;
        border-radius: 12px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0 auto 12px auto;
      }
      .feature-card img {
        width: 32px;
        height: 32px;
      }
      .feature-card p {
        margin: 0;
        font-size: 13px;
        font-weight: 500;
      }

      /* === FOOTER NAVIGATION (ROBUST & RESPONSIVE) === */
      .footer-nav {
        background-color: var(--card-bg);
        border-top: 1px solid var(--border-color);
        box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
        flex-shrink: 0;
        width: 100%;
      }
      .footer-nav ul {
        display: flex;
        justify-content: space-around;
        align-items: stretch; /* Make items fill height */
        margin: 0;
        padding: 8px 0;
        list-style: none;
        width: 100%;
      }
      .footer-nav li {
        flex: 1; /* CRITICAL CHANGE: Each item takes equal space */
        display: flex;
      }
      .footer-nav li a {
        display: flex;
        flex-direction: column;
        justify-content: center; /* Center content vertically */
        align-items: center;
        text-decoration: none;
        color: var(--text-color-light);
        font-size: 11px;
        padding: 4px 2px;
        position: relative;
        text-align: center;
        width: 100%; /* Make link fill the list item */
        transition: color 0.2s;
      }
      .footer-nav li a svg {
        width: 24px;
        height: 24px;
        margin-bottom: 4px;
        stroke: var(--text-color-light);
        transition: stroke 0.2s;
      }
      .footer-nav li.active a,
      .footer-nav li a:hover {
        color: var(--primary-color);
      }
      .footer-nav li.active a svg,
      .footer-nav li a:hover svg {
        stroke: var(--primary-color);
      }
      .footer-nav li.active a::after {
        content: "";
        position: absolute;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 40%;
        height: 3px;
        background-color: var(--primary-color);
        border-radius: 2px;
      }

      /* === Other Pages (Kompetensi, Kartu, Jadwal) === */
      .page-content {
        padding: 16px;
      }
      .page-title {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 24px;
      }
      #page-kartudigital.active .kompetent-card {
        animation: fadeInUp 0.5s ease-out;
      }
      .kompetent-card {
        background-color: #d60000;
        color: #fff;
        padding: 20px;
        border-radius: 12px;
        margin: 20px auto;
        max-width: 500px;
        perspective: 1000px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      }
      #page-jadwal.active #calendar {
        animation: fadeInUp 0.5s ease-out;
      }
      #calendar {
        max-width: 100%;
        margin: 20px auto;
      }
      .modal {
        display: none;
        position: fixed;
        z-index: 1001;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
      }
      .modal-content {
        background-color: #fff;
        margin: 15% auto;
        padding: 20px;
        border-radius: 8px;
        width: 90%;
        max-width: 400px;
      }
      .close {
        color: #aaa;
        float: right;
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
      }
      .close:hover {
        color: #000;
      }
      #page-kompetensi.active .search-container {
        animation: fadeInUp 0.5s ease-out;
      }
      .search-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        gap: 10px;
        margin-bottom: 30px;
      }
      .search-container input[type="text"] {
        flex: 1;
        min-width: 200px;
        padding: 12px 16px;
        border: 2px solid var(--primary-color);
        border-radius: 8px;
        font-size: 16px;
      }
      .search-container button {
        padding: 12px 20px;
        font-size: 14px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
      }
      .search-container button:first-of-type {
        background-color: var(--primary-color);
        color: white;
      }
      .search-container .reset-btn {
        background-color: #f0f0f0;
        color: var(--text-color);
        border: 1px solid #ccc;
      }
      .loading-text {
        text-align: center;
        font-style: italic;
        color: #555;
        margin-top: 10px;
      }
      .result-section {
        margin-top: 24px;
        padding: 0;
      }
      .result-section h2 {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 16px;
        color: var(--text-color);
      }

      /* === COMPETENCY GRID STYLES === */
      .grid-4 {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 16px;
      }
      .grid-card {
        background-color: var(--card-bg);
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        padding: 24px 16px;
        text-align: center;
        width: 100%;
        box-sizing: border-box;
        transition: transform 0.2s ease;
        opacity: 0;
        animation: fadeInUp 0.5s ease-out forwards;
      }
      .grid-card:hover {
        transform: translateY(-4px);
      }
      .grid-card img {
        width: 48px;
        height: 48px;
        margin-bottom: 12px;
      }
      .grid-card p {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-color);
        margin: 0;
      }

      /* === INDUCTION PAGE STYLES === */
      .start-induction-btn {
        display: inline-block;
        padding: 16px 32px;
        background-color: var(--primary-color);
        color: white;
        text-decoration: none;
        font-weight: 600;
        font-size: 18px;
        border-radius: 12px;
        transition: background-color 0.3s, transform 0.3s;
      }
      .start-induction-btn:hover {
        background-color: var(--primary-color-dark);
        transform: translateY(-2px);
      }
      .instruction-box {
        background-color: #fff9c4;
        border: 1px solid #fbc02d;
        color: #3e2723;
        padding: 16px;
        border-radius: 8px;
        font-size: 14px;
        line-height: 1.7;
      }

      /* === EMERGENCY PAGE STYLES === */
      .emergency-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      .emergency-item {
        display: flex;
        align-items: center;
        background-color: var(--card-bg);
        padding: 16px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        animation: fadeInUp 0.5s ease-out forwards;
      }
      .emergency-item .icon-wrapper {
        flex-shrink: 0;
        margin-right: 16px;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
      }
      .emergency-item .icon-wrapper svg {
        width: 24px;
        height: 24px;
      }
      .emergency-item .contact-info {
        flex-grow: 1;
      }
      .emergency-item .contact-info h3 {
        margin: 0 0 4px 0;
        font-size: 16px;
      }
      .emergency-item .contact-info p {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
        color: var(--primary-color);
      }
      .emergency-item .call-btn {
        padding: 10px 20px;
        background-color: #4caf50;
        color: white;
        text-decoration: none;
        border-radius: 8px;
        font-weight: 600;
        transition: background-color 0.2s;
      }
      .emergency-item .call-btn:hover {
        background-color: #45a049;
      }
    </style>
  </head>
  <body>
    <div class="mobile-wrapper">
      <div id="login-screen">
        <div class="form-container">
          <div class="logo">GAMITAS</div>
          <h2>Selamat Datang</h2>
          <p>Pilih tipe login untuk melanjutkan</p>
          <div class="login-choices">
            <div class="login-choice-btn" onclick="login('Karyawan GAM')">
              <img
                src="https://cdn-icons-png.flaticon.com/512/3081/3081559.png"
                alt="Ikon Karyawan"
              />
              <div class="btn-text">
                <h4>Login sebagai Karyawan GAM</h4>
                <p>Akses fitur untuk internal perusahaan</p>
              </div>
            </div>
            <div class="login-choice-btn" onclick="login('Mitra Kerja')">
              <img
                src="https://cdn-icons-png.flaticon.com/512/904/904772.png"
                alt="Ikon Mitra"
              />
              <div class="btn-text">
                <h4>Login sebagai Mitra Kerja</h4>
                <p>Akses fitur untuk vendor dan kontraktor</p>
              </div>
            </div>
          </div>
          <p class="register-link">
            Belum punya akun?
            <a href="#" onclick="showRegisterForm()">Daftar sekarang</a>
          </p>
        </div>
      </div>

      <div id="register-screen" style="display: none">
        <div class="form-container">
          <div class="logo">GAMITAS</div>
          <h2>Buat Akun Baru</h2>
          <form class="register-form" onsubmit="handleRegister(event)">
            <div class="form-group">
              <label for="reg-nama">Nama Lengkap</label>
              <input type="text" id="reg-nama" required />
            </div>
            <div class="form-group">
              <label for="reg-nik">NIK KTP</label>
              <input type="text" id="reg-nik" required />
            </div>
            <div class="form-group">
              <label for="reg-email">Email</label>
              <input type="email" id="reg-email" required />
            </div>
            <div class="form-group">
              <label for="reg-wa">No. WhatsApp</label>
              <input
                type="tel"
                id="reg-wa"
                required
                pattern="^(08|\+628)\d{8,11}$"
                title="Gunakan format 08... atau +628..."
              />
            </div>
            <div class="form-group">
              <label for="reg-perusahaan">Perusahaan</label>
              <input type="text" id="reg-perusahaan" required />
            </div>
            <button type="submit">Daftar Sekarang</button>
          </form>
          <p class="register-link">
            Sudah punya akun? <a href="#" onclick="showLoginForm()">Login</a>
          </p>
        </div>
      </div>

      <div id="app-container" style="display: none">
        <header class="app-header">
          <div class="logo">GAMITAS</div>
          <div class="profile-dropdown">
            <button class="profile-btn">
              <span id="header-user-name" style="font-weight: 600"></span>
              <div class="profile-avatar" id="profile-initial">?</div>
            </button>
            <div class="profile-dropdown-content">
              <a href="#">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                  <circle cx="12" cy="7" r="4" />
                </svg>
                Profil
              </a>
              <a href="#" onclick="logout()">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                  <polyline points="16 17 21 12 16 7" />
                  <line x1="21" y1="12" x2="9" y2="12" />
                </svg>
                Keluar
              </a>
            </div>
          </div>
        </header>

        <div class="scrollable-content">
          <div id="page-home" class="page">
            <section class="user-profile">
              <div class="greeting">
                <p id="time-greeting">Selamat Pagi,</p>
                <h2 id="user-greeting">Pengguna!</h2>
              </div>
            </section>

            <section class="main-tabs">
              <div class="tab active">Dashboard</div>
              <div class="tab">Insight</div>
              <div class="tab">Laporan</div>
            </section>

            <main>
              <div class="carousel-container">
                <div class="carousel-track">
                  <div class="carousel-slide">
                    <p class="card-title">Pesan Keselamatan</p>
                    <p class="card-content">
                      Selalu periksa peralatan Anda sebelum memulai pekerjaan.
                    </p>
                  </div>
                  <div class="carousel-slide">
                    <p class="card-title">Zona Berbahaya</p>
                    <p class="card-content">
                      Waspada area peledakan. Dilarang masuk tanpa izin.
                    </p>
                  </div>
                  <div class="carousel-slide">
                    <p class="card-title">Area Berbahaya</p>
                    <p class="card-content">
                      Gunakan pelindung telinga di sekitar area genset.
                    </p>
                  </div>
                </div>
                <div class="carousel-dots"></div>
              </div>

              <div class="section-title">
                <h2>Fitur Pilihan</h2>
              </div>

              <div class="feature-grid">
                <a
                  onclick="showPage('page-kompetensi')"
                  class="feature-card"
                  style="animation-delay: 0.1s"
                >
                  <div class="icon-wrapper">
                    <img
                      src="https://cdn-icons-png.flaticon.com/512/992/992648.png"
                      alt="Kompetensi Icon"
                    />
                  </div>
                  <p>Kompetensi</p>
                </a>
                <a
                  onclick="showPage('page-kartudigital')"
                  class="feature-card"
                  style="animation-delay: 0.15s"
                >
                  <div class="icon-wrapper">
                    <img
                      src="https://cdn-icons-png.flaticon.com/512/8351/8351110.png"
                      alt="Kartu Digital Icon"
                    />
                  </div>
                  <p>Kartu Digital</p>
                </a>
                <a
                  onclick="showPage('page-jadwal')"
                  class="feature-card"
                  style="animation-delay: 0.2s"
                >
                  <div class="icon-wrapper">
                    <img
                      src="https://cdn-icons-png.flaticon.com/512/3652/3652191.png"
                      alt="Jadwal Pelatihan Icon"
                    />
                  </div>
                  <p>Jadwal</p>
                </a>
                <a
                  onclick="showPage('page-induksi')"
                  class="feature-card"
                  style="animation-delay: 0.25s"
                >
                  <div class="icon-wrapper">
                    <img
                      src="https://cdn-icons-png.flaticon.com/512/3063/3063823.png"
                      alt="Induksi Icon"
                    />
                  </div>
                  <p>Induksi</p>
                </a>
                <a
                  onclick="showPage('page-emergency')"
                  class="feature-card"
                  style="animation-delay: 0.3s"
                >
                  <div class="icon-wrapper">
                    <img
                      src="https://cdn-icons-png.flaticon.com/512/2927/2927649.png"
                      alt="Nomor Darurat Icon"
                    />
                  </div>
                  <p>Nomor Darurat</p>
                </a>
                <a href="#" class="feature-card" style="animation-delay: 0.35s">
                  <div class="icon-wrapper">
                    <img
                      src="https://cdn-icons-png.flaticon.com/512/2942/2942788.png"
                      alt="Lapor Bahaya Icon"
                    />
                  </div>
                  <p>Lapor</p>
                </a>
                <a href="#" class="feature-card" style="animation-delay: 0.4s">
                  <div class="icon-wrapper">
                    <img
                      src="https://cdn-icons-png.flaticon.com/512/993/993771.png"
                      alt="Semua Fitur Icon"
                    />
                  </div>
                  <p>Lainnya</p>
                </a>
              </div>
            </main>
          </div>

          <div id="page-kompetensi" class="page">
            <main class="page-content">
              <h1 class="page-title">Kompetensi Saya</h1>
              <div class="search-container">
                <input
                  type="text"
                  id="search-kompetensi"
                  placeholder="ðŸ” Cari nama Anda di sini..."
                />
                <button onclick="searchData()">Cari</button>
                <button class="reset-btn" onclick="resetSearch()">Reset</button>
              </div>
              <div id="loading" class="loading-text" style="display: none">
                ðŸ”„ Memuat data...
              </div>
              <div id="results"></div>
            </main>
          </div>

          <div id="page-kartudigital" class="page">
            <main class="page-content">
              <h1 class="page-title">Kartu Digital</h1>
              <div class="kompetent-card">
                <div class="card-inner">
                  <section class="card-header">
                    <h1>KOMPETENT CARD</h1>
                    <p>ZERO ACCIDENT</p>
                  </section>
                  <section class="card-content">
                    <h2>10 SUPERVISORY BEHAVIOR PROFILE</h2>
                    <ul class="behavior-list">
                      <li>
                        <span class="badge">1</span>Memberikan Arahan yang Jelas
                      </li>
                      <li>
                        <span class="badge">2</span>Membuat Perencanaan Kerja
                        yang Aman
                      </li>
                      <li>
                        <span class="badge">3</span>Mendelegasikan Tugas Sesuai
                        Kompetensi K3
                      </li>
                      <li>
                        <span class="badge">4</span>Monitoring &amp; Follow-Up
                        Kegiatan K3
                      </li>
                      <li>
                        <span class="badge">5</span>Memberikan Dukungan &amp;
                        Fasilitas K3
                      </li>
                      <li>
                        <span class="badge">6</span>Membangun Komunikasi Positif
                        Mengenai Safety
                      </li>
                      <li>
                        <span class="badge">7</span>Mengembangkan Kompetensi K3
                        Tim
                      </li>
                      <li>
                        <span class="badge">8</span>Memberikan Apresiasi
                        Terhadap Perilaku Aman
                      </li>
                      <li>
                        <span class="badge">9</span>Mengelola Konflik dan Risiko
                        Sosial
                      </li>
                      <li>
                        <span class="badge">10</span>Menjadi Teladan dalam
                        Budaya K3
                      </li>
                    </ul>
                  </section>
                  <section class="card-footer">
                    <p>K3 adalah Jalan Ninjaku Menuju Keselamatan</p>
                  </section>
                </div>
              </div>
            </main>
          </div>

          <div id="page-jadwal" class="page">
            <main class="page-content">
              <h1 class="page-title">Jadwal Pelatihan</h1>
              <div id="calendar"></div>
              <div id="eventModal" class="modal">
                <div class="modal-content">
                  <span class="close">&times;</span>
                  <h3 id="modalTitle"></h3>
                  <p>
                    <strong>Tanggal Mulai:</strong>
                    <span id="modalStart"></span>
                  </p>
                  <p>
                    <strong>Tanggal Selesai:</strong>
                    <span id="modalEnd"></span>
                  </p>
                </div>
              </div>
            </main>
          </div>

          <div id="page-induksi" class="page">
            <main class="page-content">
              <h1 class="page-title">Induksi Keselamatan</h1>
              <div style="text-align: center; padding: 40px 20px">
                <img
                  src="https://cdn-icons-png.flaticon.com/512/2950/2950450.png"
                  alt="Induksi Icon"
                  style="width: 100px; height: 100px; margin-bottom: 24px"
                />
                <h3>Siap untuk Memulai?</h3>
                <p
                  style="
                    color: var(--text-color-light);
                    line-height: 1.6;
                    margin-bottom: 32px;
                  "
                >
                  Tekan tombol di bawah ini untuk memulai proses induksi
                  keselamatan. Pastikan Anda menyelesaikan seluruh materi untuk
                  dapat bekerja dengan aman di area kami.
                </p>
                <a
                  href="induksi.html"
                  target="_self"
                  class="start-induction-btn"
                >
                  Mulai Induksi
                </a>
              </div>
            </main>
          </div>

          <div id="page-induksi-pasca-cuti" class="page">
            <main class="page-content">
              <h1 class="page-title">Induksi Keselamatan Pasca Cuti</h1>
              <div
                class="induction-step"
                style="animation-delay: 0.1s; opacity: 1"
              >
                <h3>Penyegaran Keselamatan</h3>
                <p>
                  Selamat datang kembali! Sebagai bagian dari komitmen kami
                  terhadap keselamatan, Anda diwajibkan untuk meninjau kembali
                  Poin-Poin Keselamatan Kritis (Critical Safety Points) sebelum
                  kembali aktif bekerja.
                </p>
              </div>
              <div
                class="induction-step"
                style="animation-delay: 0.2s; opacity: 1"
              >
                <h4>Materi Penyegaran:</h4>
                <ul style="text-align: left; padding-left: 20px">
                  <li>Review Kebijakan K3LH terbaru.</li>
                  <li>Identifikasi bahaya di area kerja Anda saat ini.</li>
                  <li>Prosedur tanggap darurat dan lokasi Muster Point.</li>
                  <li>Penggunaan APD (Alat Pelindung Diri) yang wajib.</li>
                </ul>
              </div>
              <div
                class="induction-step final-step-box"
                style="animation-delay: 0.3s; opacity: 1"
              >
                <p>
                  Dengan menekan tombol 'Selesai', Anda menyatakan telah
                  memahami materi penyegaran ini dan siap bekerja dengan aman.
                </p>
              </div>
              <div style="text-align: center; margin-top: 24px">
                <button
                  onclick="showPage('page-home')"
                  style="
                    background-color: var(--primary-color);
                    color: white;
                    border: none;
                    padding: 12px 24px;
                    font-size: 16px;
                    border-radius: 8px;
                    cursor: pointer;
                    font-weight: 600;
                  "
                >
                  Selesai & Kembali ke Home
                </button>
              </div>
            </main>
          </div>

          <div id="page-emergency" class="page">
            <main class="page-content">
              <h1 class="page-title">Kontak Darurat</h1>
              <div
                class="instruction-box"
                style="
                  margin-bottom: 24px;
                  display: flex;
                  align-items: center;
                  gap: 12px;
                "
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="32"
                  height="32"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="#fbc02d"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path
                    d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"
                  />
                  <line x1="12" x2="12" y1="9" y2="13" />
                  <line x1="12" x2="12.01" y1="17" y2="17" />
                </svg>
                <span
                  >Gunakan nomor ini hanya untuk keadaan darurat yang mengancam
                  jiwa atau properti.</span
                >
              </div>
              <div class="emergency-list">
                <div class="emergency-item" style="animation-delay: 0.1s">
                  <div
                    class="icon-wrapper"
                    style="background-color: var(--primary-color-dark)"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path
                        d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"
                      />
                    </svg>
                  </div>
                  <div class="contact-info">
                    <h3>ERT (Emergency Response Team)</h3>
                    <p>0821-1667-7991</p>
                  </div>
                  <a href="tel:082116677991" class="call-btn">Panggil</a>
                </div>
                <div class="emergency-item" style="animation-delay: 0.2s">
                  <div class="icon-wrapper" style="background-color: #1e88e5">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path
                        d="M20.59 4.85a2.05 2.05 0 0 0-2.93 0L16.5 6l-3.5-3.5L11.5 1a2.05 2.05 0 0 0-2.93 0L3.41 6.15a2.05 2.05 0 0 0 0 2.93L5 10.5l3.5 3.5L7 15.5a2.05 2.05 0 0 0 0 2.93l5.15 5.15a2.05 2.05 0 0 0 2.93 0L21 18l-3.5-3.5L19 13a2.05 2.05 0 0 0 0-2.93Z"
                      />
                      <path d="m18 1-1 1" />
                    </svg>
                  </div>
                  <div class="contact-info">
                    <h3>Klinik</h3>
                    <p>0813-1661-5353</p>
                  </div>
                  <a href="tel:081316615353" class="call-btn">Panggil</a>
                </div>
                <div class="emergency-item" style="animation-delay: 0.3s">
                  <div class="icon-wrapper" style="background-color: #43a047">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path d="M12 22a10 10 0 1 0-10-10h.01" />
                      <path d="M16 16c-2.5-2.5-2.5-7.5-2.5-7.5s0 5-2.5 7.5" />
                      <path d="M14 14c-1.5-1.5-1.5-4.5-1.5-4.5s0 3-1.5 4.5" />
                      <path d="M12 12c-.5-.5-.5-1.5-.5-1.5s0 1-.5 1.5" />
                    </svg>
                  </div>
                  <div class="contact-info">
                    <h3>Channel Radio HSE / ERT</h3>
                    <p>165.475</p>
                  </div>
                </div>
              </div>
            </main>
          </div>
        </div>

        <nav class="footer-nav">
          <ul>
            <li id="nav-home" class="active">
              <a href="#" onclick="showPage('page-home')"
                ><svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                  <polyline points="9 22 9 12 15 12 15 22" /></svg
                ><span>Home</span></a
              >
            </li>
            <li id="nav-kompetensi">
              <a href="#" onclick="showPage('page-kompetensi')"
                ><svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path
                    d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"
                  /></svg
                ><span>Kompetensi</span></a
              >
            </li>
            <li id="nav-kartudigital">
              <a href="#" onclick="showPage('page-kartudigital')"
                ><svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <rect width="20" height="14" x="2" y="5" rx="2" />
                  <line x1="2" x2="22" y1="10" y2="10" /></svg
                ><span>Kartu</span></a
              >
            </li>
            <li id="nav-jadwal">
              <a href="#" onclick="showPage('page-jadwal')"
                ><svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M8 2v4" />
                  <path d="M16 2v4" />
                  <rect width="18" height="18" x="3" y="4" rx="2" />
                  <path d="M3 10h18" /></svg
                ><span>Jadwal</span></a
              >
            </li>
            <li id="nav-induksi">
              <a href="#" onclick="showPage('page-induksi')"
                ><svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path
                    d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"
                  /></svg
                ><span>Induksi</span></a
              >
            </li>
            <li id="nav-emergency">
              <a href="#" onclick="showPage('page-emergency')"
                ><svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path
                    d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"
                  />
                  <line x1="12" x2="12" y1="9" y2="13" />
                  <line x1="12" x2="12.01" y1="17" y2="17" /></svg
                ><span>Darurat</span></a
              >
            </li>
          </ul>
        </nav>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

    <script>
      // --- PWA Setup ---
      function setupPWA() {
        const manifest = {
          name: "GAMITAS - Aplikasi Keselamatan",
          short_name: "GAMITAS",
          description:
            "Aplikasi terpadu untuk manajemen kompetensi dan keselamatan kerja.",
          start_url: ".",
          display: "standalone",
          background_color: "#f5f5f5",
          theme_color: "#ffffff",
          icons: [
            {
              src: "https://cdn-icons-png.flaticon.com/192x192/3468/3468379.png",
              sizes: "192x192",
              type: "image/png",
              purpose: "any maskable",
            },
            {
              src: "https://cdn-icons-png.flaticon.com/512x512/3468/3468379.png",
              sizes: "512x512",
              type: "image/png",
              purpose: "any maskable",
            },
          ],
        };
        const manifestBlob = new Blob([JSON.stringify(manifest)], {
          type: "application/json",
        });
        const manifestURL = URL.createObjectURL(manifestBlob);
        document
          .querySelector('link[rel="manifest"]')
          .setAttribute("href", manifestURL);
      }

      // --- Global Variables & State ---
      let calendarInstance = null;
      let calendarRendered = false;
      let kompetensiInitialized = false;
      let lastScrollTop = 0;
      let carouselInterval;

      // --- Time-based Greeting ---
      function getTimeBasedGreeting() {
        const hour = new Date().getHours();
        if (hour < 12) return "Selamat Pagi";
        if (hour < 15) return "Selamat Siang";
        if (hour < 18) return "Selamat Sore";
        return "Selamat Malam";
      }

      // --- Carousel Logic ---
      function initCarousel() {
        const track = document.querySelector(".carousel-track");
        if (!track) return;
        const slides = Array.from(track.children);
        const dotsContainer = document.querySelector(".carousel-dots");
        dotsContainer.innerHTML = ""; // Clear existing dots
        let slideIndex = 0;

        slides.forEach((_, i) => {
          const dot = document.createElement("span");
          dot.classList.add("dot");
          if (i === 0) dot.classList.add("active");
          dot.addEventListener("click", () => {
            slideIndex = i;
            updateCarousel();
            resetCarouselInterval();
          });
          dotsContainer.appendChild(dot);
        });

        const dots = Array.from(dotsContainer.children);

        const updateCarousel = () => {
          track.style.transform = "translateX(-" + slideIndex * 100 + "%)";
          dots.forEach((dot) => dot.classList.remove("active"));
          dots[slideIndex].classList.add("active");
        };

        const resetCarouselInterval = () => {
          clearInterval(carouselInterval);
          carouselInterval = setInterval(() => {
            slideIndex = (slideIndex + 1) % slides.length;
            updateCarousel();
          }, 5000); // 5 seconds
        };

        resetCarouselInterval();
      }

      // --- Page Navigation ---
      function showPage(pageId) {
        document
          .querySelectorAll(".page")
          .forEach((page) => page.classList.remove("active"));
        const targetPage = document.getElementById(pageId);
        if (targetPage) targetPage.classList.add("active");

        const modernHeaderElements = document.querySelectorAll(
          ".user-profile, .main-tabs"
        );
        if (pageId === "page-home") {
          modernHeaderElements.forEach((el) => (el.style.display = "flex"));
          initCarousel();
        } else {
          modernHeaderElements.forEach((el) => (el.style.display = "none"));
          clearInterval(carouselInterval);
        }

        if (pageId === "page-jadwal" && !calendarRendered) initCalendar();
        if (pageId === "page-kartudigital") initDigitalCard();
        if (pageId === "page-kompetensi" && !kompetensiInitialized)
          initKompetensiPage();

        updateFooterNav(pageId);
        document.querySelector(".scrollable-content").scrollTo(0, 0);
      }

      function updateFooterNav(pageId) {
        document
          .querySelectorAll(".footer-nav li")
          .forEach((li) => li.classList.remove("active"));
        let navId = "nav-home";
        if (pageId.startsWith("page-")) {
          const pageName = pageId.split("-")[1];
          const navItem = document.getElementById("nav-" + pageName);
          if (navItem) {
            navId = "nav-" + pageName;
          }
        }
        const activeNav = document.getElementById(navId);
        if (activeNav) activeNav.classList.add("active");
      }

      // --- Authentication & User Flow ---
      function login(userType) {
        localStorage.setItem("userType", userType);
        const loginScreen = document.getElementById("login-screen");
        const appContainer = document.getElementById("app-container");

        loginScreen.style.animation = "fadeOut 0.5s forwards";

        setTimeout(() => {
          loginScreen.style.display = "none";
          appContainer.style.display = "flex";
          appContainer.style.animation = "fadeIn 0.5s";

          document.getElementById("user-greeting").textContent = `${userType}!`;
          document.getElementById("time-greeting").textContent =
            getTimeBasedGreeting() + ",";
          document.getElementById("header-user-name").textContent =
            userType.split(" ")[0];
          document.getElementById("profile-initial").textContent =
            userType.charAt(0);

          initCarousel();
        }, 500);
      }

      function logout() {
        localStorage.removeItem("userType");
        window.location.reload();
      }

      function showRegisterForm() {
        document.getElementById("login-screen").style.display = "none";
        document.getElementById("register-screen").style.display = "flex";
      }

      function showLoginForm() {
        document.getElementById("register-screen").style.display = "none";
        document.getElementById("login-screen").style.display = "flex";
      }

      function handleRegister(event) {
        event.preventDefault();
        alert("Pendaftaran berhasil! Silakan login.");
        showLoginForm();
      }

      // --- App Initialization ---
      window.addEventListener("DOMContentLoaded", () => {
        setupPWA();
        const storedUserType = localStorage.getItem("userType");
        const loginScreen = document.getElementById("login-screen");
        const appContainer = document.getElementById("app-container");
        const header = document.querySelector(".app-header");
        const scrollableContent = document.querySelector(".scrollable-content");

        if (storedUserType) {
          loginScreen.style.display = "none";
          appContainer.style.display = "flex";
          document.getElementById(
            "user-greeting"
          ).textContent = `${storedUserType}!`;
          document.getElementById("time-greeting").textContent =
            getTimeBasedGreeting() + ",";
          document.getElementById("header-user-name").textContent =
            storedUserType.split(" ")[0];
          document.getElementById("profile-initial").textContent =
            storedUserType.charAt(0);
        } else {
          loginScreen.style.display = "flex";
          appContainer.style.display = "none";
        }
        showPage("page-home");

        scrollableContent.addEventListener(
          "scroll",
          function () {
            var st = scrollableContent.scrollTop;
            if (st > lastScrollTop && st > 50) {
              header.classList.add("hidden");
            } else {
              header.classList.remove("hidden");
            }
            lastScrollTop = st <= 0 ? 0 : st;
          },
          false
        );
      });

      // --- Page-Specific Initializers ---
      function initDigitalCard() {
        const card3d = document.querySelector(".kompetent-card");
        if (!card3d) return;
        const inner = card3d.querySelector(".card-inner");
        card3d.addEventListener("mousemove", (e) => {
          const rect = card3d.getBoundingClientRect();
          const xPos = e.clientX - rect.left;
          const yPos = e.clientY - rect.top;
          const centerX = rect.width / 2;
          const centerY = rect.height / 2;
          const rotY = ((xPos - centerX) / centerX) * 10;
          const rotX = ((centerY - yPos) / centerY) * 10;
          inner.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`;
        });
        card3d.addEventListener("mouseleave", () => {
          inner.style.transform = "rotateX(0deg) rotateY(0deg)";
        });
        document.querySelectorAll(".behavior-list li").forEach((li) => {
          li.addEventListener("click", () => {
            li.classList.toggle("completed");
          });
        });
      }

      async function initCalendar() {
        const calendarEl = document.getElementById("calendar");
        if (!calendarEl) return;
        const modal = document.getElementById("eventModal");
        const modalTitle = document.getElementById("modalTitle");
        const modalStart = document.getElementById("modalStart");
        const modalEnd = document.getElementById("modalEnd");
        const closeBtn = modal.querySelector(".close");
        const spreadsheetId = "1tuTh3lLiPYAUOJwCTpvsag6jqt9TZXuieSjI2Q1T42A";
        const sheetName = "training_calendar";
        const url = `https://opensheet.elk.sh/${spreadsheetId}/${sheetName}`;
        try {
          const response = await fetch(url);
          if (!response.ok)
            throw new Error(
              `Network response was not ok: ${response.statusText}`
            );
          const data = await response.json();
          const events = data.map((row) => ({
            title: row.Title,
            start: row.Start,
            end: row.End || row.Start,
          }));
          calendarInstance = new FullCalendar.Calendar(calendarEl, {
            initialView: window.innerWidth < 768 ? "listWeek" : "dayGridMonth",
            events: events,
            height: "auto",
            headerToolbar: {
              left: "prev,next today",
              center: "title",
              right: "dayGridMonth,timeGridWeek",
            },
            eventClick: function (info) {
              modalTitle.textContent = info.event.title;
              modalStart.textContent = new Date(
                info.event.start
              ).toLocaleDateString("id-ID");
              modalEnd.textContent = info.event.end
                ? new Date(info.event.end).toLocaleDateString("id-ID")
                : new Date(info.event.start).toLocaleDateString("id-ID");
              modal.style.display = "block";
            },
          });
          calendarInstance.render();
          calendarRendered = true;
          closeBtn.onclick = () => {
            modal.style.display = "none";
          };
          window.onclick = (event) => {
            if (event.target === modal) {
              modal.style.display = "none";
            }
          };
        } catch (error) {
          console.error("Gagal mengambil data dari spreadsheet:", error);
          calendarEl.innerHTML = `<p style="text-align:center; color:red;">Gagal memuat jadwal. Silakan coba lagi nanti.</p>`;
        }
      }

      // --- Kompetensi Page Logic (with Google Sheets API) ---
      const apiKey = "AIzaSyA7Wbhd7KYAMKt10vKVnJY81qDWTCs9MPw";
      const spreadsheetId_kompetensi =
        "1IUZpjUEHsZe-4k4V6w1JqDNSH9zw9gKpceogu6cqx3Q";
      const sheet1Range = "BASE MANPOWER!E:I";
      const sheet2Range = "KOMPETENSI SEARCH GITHUB!B:G";
      const sheet3Range = "DEPT_JAB_GITHUB!A:E";

      function initKompetensiPage() {
        const lastSearch = localStorage.getItem("lastSearchKompetensi");
        if (lastSearch) {
          document.getElementById("search-kompetensi").value = lastSearch;
          searchData();
        }
        kompetensiInitialized = true;
      }

      function searchData() {
        const searchTerm = document
          .getElementById("search-kompetensi")
          .value.trim()
          .toLowerCase();
        if (!searchTerm) {
          alert("Silakan masukkan nama untuk mencari.");
          return;
        }
        localStorage.setItem("lastSearchKompetensi", searchTerm);
        document.getElementById("loading").style.display = "block";
        document.getElementById("results").innerHTML = "";
        const sheet1Url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId_kompetensi}/values/${sheet1Range}?key=${apiKey}`;
        const sheet2Url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId_kompetensi}/values/${sheet2Range}?key=${apiKey}`;
        const sheet3Url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId_kompetensi}/values/${sheet3Range}?key=${apiKey}`;
        Promise.all([
          fetch(sheet1Url).then((res) => res.json()),
          fetch(sheet2Url).then((res) => res.json()),
          fetch(sheet3Url).then((res) => res.json()),
        ])
          .then(([data1, data2, data3]) => {
            const manpowerResults = (data1.values || []).filter(
              (row) =>
                row &&
                row[0] &&
                typeof row[0] === "string" &&
                row[0].toLowerCase().includes(searchTerm)
            );
            const competencyResults = (data2.values || []).filter(
              (row) =>
                row &&
                row[0] &&
                typeof row[0] === "string" &&
                row[0].toLowerCase().includes(searchTerm)
            );
            const recommendationData = data3.values || [];

            displayKompetensiResults(competencyResults, "Status Kompetensi");
            displayCompetencyRecommendations(
              manpowerResults,
              recommendationData,
              competencyResults.length
            );

            document.getElementById("loading").style.display = "none";
          })
          .catch((error) => {
            console.error("Gagal mengambil data:", error);
            document.getElementById("loading").innerHTML =
              "Terjadi kesalahan saat mengambil data.";
          });
      }

      function displayKompetensiResults(results, sectionTitle) {
        const resultsDiv = document.getElementById("results");
        const section = document.createElement("section");
        section.className = "result-section";
        const title = document.createElement("h2");
        title.innerText = sectionTitle;
        section.appendChild(title);

        const listContainer = document.createElement("div");
        listContainer.className = "grid-4";

        if (!results || results.length === 0) {
          const noDataMessage = document.createElement("p");
          noDataMessage.textContent = `Tidak ada data kompetensi yang ditemukan.`;
          section.appendChild(noDataMessage);
        } else {
          results.forEach((row, index) => {
            const item = document.createElement("div");
            item.className = "grid-card";
            item.style.animationDelay = `${index * 0.05}s`;

            let icon =
              "https://cdn-icons-png.flaticon.com/512/4213/4213843.png"; // Default: Help/Unknown
            let label = row[3] || "Pelatihan Tidak Terdaftar";
            let status = row[4];

            if (status === "Y") {
              icon = "https://cdn-icons-png.flaticon.com/512/190/190411.png"; // Check
            } else if (status === "OFF") {
              icon = "https://cdn-icons-png.flaticon.com/512/1828/1828843.png"; // Cross
            } else if (status === "Y/I") {
              icon = "https://cdn-icons-png.flaticon.com/512/107/107144.png"; // Hourglass/Pending
            }

            item.innerHTML = `
                    <img src="${icon}" alt="Status Icon" />
                    <p>${label}</p>
                `;
            listContainer.appendChild(item);
          });
          section.appendChild(listContainer);
        }
        resultsDiv.appendChild(section);
      }

      function displayCompetencyRecommendations(
        manpowerResults,
        recommendationData,
        competencyCount = 0
      ) {
        const resultsDiv = document.getElementById("results");
        const section = document.createElement("section");
        section.className = "result-section";
        const title = document.createElement("h2");
        title.innerText = "Rekomendasi Kompetensi Jabatan";
        section.appendChild(title);

        const listContainer = document.createElement("div");
        listContainer.className = "grid-4";

        const matches = [];
        const uniqueRoles = new Set();

        manpowerResults.forEach((row) => {
          const dept = row[1]?.trim().toLowerCase();
          const jabatan = row[4]?.trim().toLowerCase();
          if (dept && jabatan) uniqueRoles.add(`${dept}|${jabatan}`);
        });

        uniqueRoles.forEach((roleKey) => {
          const [deptKey, jabKey] = roleKey.split("|");
          recommendationData.forEach((row3) => {
            const dept3 = row3[0]?.trim().toLowerCase();
            const jab3 = row3[2]?.trim().toLowerCase();
            const namaPelatihan = row3[4];
            if (dept3 === deptKey && jab3 === jabKey && namaPelatihan) {
              const key = `${jab3}|${namaPelatihan}`;
              if (!matches.some((item) => item.key === key)) {
                matches.push({ namaPelatihan, key });
              }
            }
          });
        });

        if (matches.length === 0) {
          const noDataMessage = document.createElement("p");
          noDataMessage.textContent =
            "Tidak ada rekomendasi kompetensi yang cocok.";
          section.appendChild(noDataMessage);
        } else {
          matches.forEach((item, index) => {
            const listItem = document.createElement("div");
            listItem.className = "grid-card";
            listItem.style.animationDelay = `${
              (competencyCount + index) * 0.05
            }s`;

            listItem.innerHTML = `
                    <img src="https://cdn-icons-png.flaticon.com/512/3063/3063823.png" alt="Rekomendasi Icon" />
                    <p>${item.namaPelatihan}</p>
                `;
            listContainer.appendChild(listItem);
          });
          section.appendChild(listContainer);
        }
        resultsDiv.appendChild(section);
      }

      function resetSearch() {
        document.getElementById("search-kompetensi").value = "";
        document.getElementById("results").innerHTML = "";
        document.getElementById("loading").style.display = "none";
        localStorage.removeItem("lastSearchKompetensi");
      }
    </script>
  </body>
</html>
